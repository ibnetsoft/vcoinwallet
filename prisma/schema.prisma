// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// 사용자 모델
model User {
  id            String   @id @default(cuid())
  name          String   // 실명 (필수)
  phone         String   @unique // 핸드폰번호 (필수, 고유)
  email         String?  // 이메일 (선택)
  password      String   // 비밀번호 (6자리 이상)
  
  // 추천인 관계
  referralCode  String   @unique // 내 추천 코드
  referrerId    String?  // 추천인 ID
  referrer      User?    @relation("Referrals", fields: [referrerId], references: [id])
  referrals     User[]   @relation("Referrals") // 내가 추천한 사람들
  
  // 코인 잔액
  securityCoins Int      @default(0) // 증권코인
  dividendCoins Int      @default(0) // 배당코인
  
  // 회원 가입 순서
  memberNumber  Int      @unique
  
  // 관리자 여부
  isAdmin       Boolean  @default(false)
  
  // 타임스탬프
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  // 관계
  transactions  Transaction[]
  dividends     Dividend[]
}

// 거래 내역
model Transaction {
  id            String   @id @default(cuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id])
  
  type          TransactionType // 거래 유형
  coinType      CoinType        // 코인 종류
  amount        Int             // 수량
  balance       Int             // 거래 후 잔액
  description   String?         // 설명
  
  // 추천 관련
  referralId    String?         // 추천으로 인한 거래인 경우
  
  createdAt     DateTime @default(now())
}

// 배당 내역
model Dividend {
  id            String   @id @default(cuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id])
  
  amount        Float    // 배당금액
  coins         Int      // 배당 기준 코인 수
  rate          Float    // 배당률
  period        String   // 배당 기간 (예: "2025-01")
  status        DividendStatus @default(PENDING)
  
  paidAt        DateTime?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

// 시스템 설정
model SystemConfig {
  id            String   @id @default("config")
  
  // 증권코인 지급 설정
  currentMemberCount    Int @default(0)
  securityCoinNewUser   Int @default(500)
  securityCoinReferral  Int @default(1000)
  
  // 배당코인 설정
  dividendCoinPer100    Int @default(10000) // 100만원당 코인
  dividendCoinReferral  Int @default(1000)  // 추천인 보너스
  
  updatedAt     DateTime @updatedAt
}

// 열거형 정의
enum TransactionType {
  SIGNUP_BONUS      // 가입 보너스
  REFERRAL_BONUS    // 추천 보너스
  PURCHASE          // 구매
  DIVIDEND_PAYMENT  // 배당 지급
  ADMIN_GRANT       // 관리자 지급
  ADMIN_DEDUCT      // 관리자 차감
}

enum CoinType {
  SECURITY  // 증권코인
  DIVIDEND  // 배당코인
}

enum DividendStatus {
  PENDING   // 대기중
  PAID      // 지급완료
  CANCELLED // 취소
}
